<!DOCTYPE html>
<html lang="fa" dir="rtl" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒØ³ØªÙ… | Ø±Ø¨Ø§Øª Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙˆÛŒØ¯ÛŒÙˆ ÛŒÙˆØªÛŒÙˆØ¨</title>
    <link rel="stylesheet" href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.css">
</head>
<body>
    <div class="container py-4">
        <header class="mb-5">
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="h2 fw-bold mb-0">ğŸ“Š ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒØ³ØªÙ…</h1>
                <a href="{{ url_for('index') }}" class="btn btn-outline-secondary btn-sm">
                    <i data-feather="home"></i> Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ
                </a>
            </div>
            <hr>
        </header>

        <div class="status-summary mb-4">
            <div class="row g-3">
                <div class="col-md-3">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title text-info">
                                <i data-feather="cpu"></i> CPU
                            </h5>
                            <div class="d-flex align-items-center mt-3">
                                <div class="progress flex-grow-1" style="height: 10px;">
                                    <div class="progress-bar bg-info" role="progressbar" 
                                        style="width: {{ system.cpu.usage_percent }}%;" 
                                        aria-valuenow="{{ system.cpu.usage_percent }}" 
                                        aria-valuemin="0" aria-valuemax="100">
                                    </div>
                                </div>
                                <span class="ms-2 fw-bold">{{ system.cpu.usage_percent }}%</span>
                            </div>
                            <div class="text-muted small mt-2">
                                {{ system.cpu.cores }} Ù‡Ø³ØªÙ‡
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-3">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title text-success">
                                <i data-feather="server"></i> Ø­Ø§ÙØ¸Ù‡
                            </h5>
                            <div class="d-flex align-items-center mt-3">
                                <div class="progress flex-grow-1" style="height: 10px;">
                                    <div class="progress-bar bg-success" role="progressbar" 
                                        style="width: {{ system.memory.percent_used }}%;" 
                                        aria-valuenow="{{ system.memory.percent_used }}" 
                                        aria-valuemin="0" aria-valuemax="100">
                                    </div>
                                </div>
                                <span class="ms-2 fw-bold">{{ system.memory.percent_used }}%</span>
                            </div>
                            <div class="text-muted small mt-2">
                                {{ system.memory.used_human }} / {{ system.memory.total_human }}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-3">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title text-warning">
                                <i data-feather="hard-drive"></i> Ø¯ÛŒØ³Ú©
                            </h5>
                            <div class="d-flex align-items-center mt-3">
                                <div class="progress flex-grow-1" style="height: 10px;">
                                    <div class="progress-bar bg-warning" role="progressbar" 
                                        style="width: {{ system.disk.percent_used }}%;" 
                                        aria-valuenow="{{ system.disk.percent_used }}" 
                                        aria-valuemin="0" aria-valuemax="100">
                                    </div>
                                </div>
                                <span class="ms-2 fw-bold">{{ system.disk.percent_used }}%</span>
                            </div>
                            <div class="text-muted small mt-2">
                                {{ system.disk.free_human }} Ø¢Ø²Ø§Ø¯ Ø§Ø² {{ system.disk.total_human }}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-3">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title text-danger">
                                <i data-feather="activity"></i> ÙØ¹Ø§Ù„ÛŒØª
                            </h5>
                            <div class="mt-3">
                                <span class="badge bg-primary rounded-pill">{{ active_downloads|length }} Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ¹Ø§Ù„</span>
                            </div>
                            <div class="text-muted small mt-2">
                                {{ system.uptime.uptime_human }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-4">
            <div class="col-md-6">
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-transparent">
                        <h5 class="mb-0">
                            <i data-feather="download"></i> Ø¯Ø§Ù†Ù„ÙˆØ¯Ù‡Ø§ÛŒ ÙØ¹Ø§Ù„
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        {% if active_downloads %}
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead>
                                        <tr>
                                            <th scope="col">#</th>
                                            <th scope="col">Ú©Ø§Ø±Ø¨Ø±</th>
                                            <th scope="col">Ù¾ÛŒØ´Ø±ÙØª</th>
                                            <th scope="col">ÙˆØ¶Ø¹ÛŒØª</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for id, download in active_downloads.items() %}
                                        <tr>
                                            <td>{{ id }}</td>
                                            <td>{{ download.user_id }}</td>
                                            <td>
                                                <div class="progress" style="height: 6px;">
                                                    <div class="progress-bar" role="progressbar" 
                                                        style="width: {{ download.progress }}%;" 
                                                        aria-valuenow="{{ download.progress }}" 
                                                        aria-valuemin="0" aria-valuemax="100">
                                                    </div>
                                                </div>
                                                <small>{{ download.progress }}%</small>
                                            </td>
                                            <td><small>{{ download.status }}</small></td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="text-center p-4 text-muted">
                                <i data-feather="info" class="mb-3" style="width: 48px; height: 48px;"></i>
                                <p>Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ¹Ø§Ù„ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-transparent">
                        <h5 class="mb-0">
                            <i data-feather="hard-drive"></i> Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ…
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="system-info-item">
                            <span>Ø³ÛŒØ³ØªÙ… Ø¹Ø§Ù…Ù„:</span>
                            <span>{{ system.os.system }} {{ system.os.release }}</span>
                        </div>
                        <div class="system-info-item">
                            <span>Ù…Ø¹Ù…Ø§Ø±ÛŒ:</span>
                            <span>{{ system.os.architecture }}</span>
                        </div>
                        <div class="system-info-item">
                            <span>Ù†Ø³Ø®Ù‡ Ù¾Ø§ÛŒØªÙˆÙ†:</span>
                            <span>{{ system.os.python_version }}</span>
                        </div>
                        <div class="system-info-item">
                            <span>Ø²Ù…Ø§Ù† Ú©Ø§Ø±Ú©Ø±Ø¯:</span>
                            <span>{{ system.uptime.uptime_human }}</span>
                        </div>
                        <div class="system-info-item">
                            <span>Ø²Ù…Ø§Ù† Ø´Ø±ÙˆØ¹ Ø³ÛŒØ³ØªÙ…:</span>
                            <span>{{ system.uptime.boot_time }}</span>
                        </div>
                        <div class="system-info-item">
                            <span>ØªØ¹Ø¯Ø§Ø¯ Ù‡Ø³ØªÙ‡â€ŒÙ‡Ø§ÛŒ CPU:</span>
                            <span>{{ system.cpu.cores }}</span>
                        </div>
                        <div class="system-info-item">
                            <span>Ù…ØµØ±Ù Ø­Ø§ÙØ¸Ù‡ ÙØ±Ø§ÛŒÙ†Ø¯:</span>
                            <span>{{ system.process.this_process.memory_usage }}</span>
                        </div>
                        <div class="system-info-item">
                            <span>ØªØ¹Ø¯Ø§Ø¯ ØªØ±Ø¯â€ŒÙ‡Ø§ÛŒ ÙØ±Ø§ÛŒÙ†Ø¯:</span>
                            <span>{{ system.process.this_process.threads_count }}</span>
                        </div>
                        {% if system.network %}
                        <div class="system-info-item">
                            <span>ØªØ¹Ø¯Ø§Ø¯ Ø§ØªØµØ§Ù„Ø§Øª Ø´Ø¨Ú©Ù‡:</span>
                            <span>{{ system.network.connections }}</span>
                        </div>
                        <div class="system-info-item">
                            <span>Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¨Ú©Ù‡:</span>
                            <span>{{ system.network.bytes_recv }}</span>
                        </div>
                        <div class="system-info-item">
                            <span>Ø§Ø±Ø³Ø§Ù„ Ø´Ø¨Ú©Ù‡:</span>
                            <span>{{ system.network.bytes_sent }}</span>
                        </div>
                        {% endif %}
                        {% if system.server %}
                        <div class="system-info-item">
                            <span>Ù†Ø§Ù… Ù…ÛŒØ²Ø¨Ø§Ù†:</span>
                            <span>{{ system.server.hostname }}</span>
                        </div>
                        <div class="system-info-item">
                            <span>Ù…Ù†Ø·Ù‚Ù‡ Ø²Ù…Ø§Ù†ÛŒ:</span>
                            <span>{{ system.server.timezone }}</span>
                        </div>
                        <div class="system-info-item">
                            <span>ØªØ¹Ø¯Ø§Ø¯ ØªØ±Ø¯â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„:</span>
                            <span>{{ system.server.active_threads }}</span>
                        </div>
                        <div class="system-info-item">
                            <span>Ø²Ù…Ø§Ù† Ø³Ø±ÙˆØ±:</span>
                            <span>{{ system.server.current_time }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-transparent">
                        <h5 class="mb-0">
                            <i data-feather="users"></i> Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø§Ø®ÛŒØ±
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        {% if users %}
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead>
                                        <tr>
                                            <th scope="col">Ø´Ù†Ø§Ø³Ù‡</th>
                                            <th scope="col">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</th>
                                            <th scope="col">Ù†Ø§Ù…</th>
                                            <th scope="col">Ù†Ù‚Ø´</th>
                                            <th scope="col">Ø¯Ø§Ù†Ù„ÙˆØ¯â€ŒÙ‡Ø§</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for user in users %}
                                        <tr>
                                            <td>{{ user.id }}</td>
                                            <td>{{ user.username or "-" }}</td>
                                            <td>{{ user.first_name or "-" }}</td>
                                            <td>
                                                {% if user.role == -1 %}
                                                    <span class="badge bg-danger">Ù…Ø³Ø¯ÙˆØ¯</span>
                                                {% elif user.role == 0 %}
                                                    <span class="badge bg-secondary">Ø¹Ø§Ø¯ÛŒ</span>
                                                {% elif user.role == 1 %}
                                                    <span class="badge bg-primary">ÙˆÛŒÚ˜Ù‡</span>
                                                {% elif user.role >= 2 %}
                                                    <span class="badge bg-warning">Ø§Ø¯Ù…ÛŒÙ†</span>
                                                {% endif %}
                                            </td>
                                            <td>{{ user.download_count }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="text-center p-4 text-muted">
                                <i data-feather="users" class="mb-3" style="width: 48px; height: 48px;"></i>
                                <p>Ù‡ÛŒÚ† Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</p>
                            </div>
                        {% endif %}
                    </div>
                    <div class="card-footer text-muted bg-transparent">
                        <small>ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†: {{ user_count }}</small>
                    </div>
                </div>

                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-transparent">
                        <h5 class="mb-0">
                            <i data-feather="download-cloud"></i> Ø¯Ø§Ù†Ù„ÙˆØ¯Ù‡Ø§ÛŒ Ø§Ø®ÛŒØ±
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        {% if downloads %}
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead>
                                        <tr>
                                            <th scope="col">#</th>
                                            <th scope="col">Ú©Ø§Ø±Ø¨Ø±</th>
                                            <th scope="col">Ø¹Ù†ÙˆØ§Ù†</th>
                                            <th scope="col">ÙˆØ¶Ø¹ÛŒØª</th>
                                            <th scope="col">Ø­Ø¬Ù…</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for download in downloads %}
                                        <tr>
                                            <td>{{ download.id }}</td>
                                            <td>{{ download.user_id }}</td>
                                            <td>
                                                {% if download.metadata and download.metadata.title %}
                                                    {{ download.metadata.title|truncate(20) }}
                                                {% else %}
                                                    <small class="text-muted">Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†</small>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if download.status == 0 %}
                                                    <span class="badge bg-secondary">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</span>
                                                {% elif download.status == 1 %}
                                                    <span class="badge bg-info">Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´</span>
                                                {% elif download.status == 2 %}
                                                    <span class="badge bg-success">ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡</span>
                                                {% elif download.status == 3 %}
                                                    <span class="badge bg-danger">Ø¨Ø§ Ø®Ø·Ø§ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯</span>
                                                {% elif download.status == 4 %}
                                                    <span class="badge bg-warning">Ù„ØºÙˆ Ø´Ø¯Ù‡</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if download.file_size %}
                                                    <small>{{ (download.file_size / (1024*1024))|round(1) }} MB</small>
                                                {% else %}
                                                    <small>-</small>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="text-center p-4 text-muted">
                                <i data-feather="download-cloud" class="mb-3" style="width: 48px; height: 48px;"></i>
                                <p>Ù‡ÛŒÚ† Ø¯Ø§Ù†Ù„ÙˆØ¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</p>
                            </div>
                        {% endif %}
                    </div>
                    <div class="card-footer text-muted bg-transparent">
                        <small>ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯Ù‡Ø§: {{ download_count }}</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center mt-4">
            <a href="{{ url_for('webhook_test') }}" class="btn btn-outline-info me-2">
                <i data-feather="refresh-cw"></i> Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ÙˆØ¨â€ŒÙ‡ÙˆÚ©
            </a>
            <a href="{{ url_for('ping') }}" class="btn btn-outline-success">
                <i data-feather="heart"></i> Ø¨Ø±Ø±Ø³ÛŒ Ø³Ù„Ø§Ù…Øª Ø³ÛŒØ³ØªÙ…
            </a>
        </div>

        <footer class="mt-5 text-center text-muted">
            <p>Ø±Ø¨Ø§Øª Ù‡ÙˆØ´Ù…Ù†Ø¯ Ú†Ù†Ø¯Ù…Ù†Ø¸ÙˆØ±Ù‡ ØªÙ„Ú¯Ø±Ø§Ù… &copy; {{ system.timestamp.split('T')[0] if system.timestamp else '' }}</p>
            <p class="small">Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ø² ÛŒÙˆØªÛŒÙˆØ¨ØŒ Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…ØŒ Ø¬Ø³ØªØ¬ÙˆÛŒ Ù‡Ø´ØªÚ¯ØŒ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ùˆ Ø¨Ø³ÛŒØ§Ø±ÛŒ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø±</p>
            <p class="small">Ø¢Ø®Ø±ÛŒÙ† Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: {{ system.timestamp.replace('T', ' ').split('.')[0] if system.timestamp else '' }}</p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            feather.replace();
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± ØµÙØ­Ù‡ Ù‡Ø± 30 Ø«Ø§Ù†ÛŒÙ‡
            setTimeout(function() {
                location.reload();
            }, 30000);
        });
    </script>
</body>
</html>
